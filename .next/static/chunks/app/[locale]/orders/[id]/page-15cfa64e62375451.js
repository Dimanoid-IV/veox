(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[659],{1847:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(2115);let a=function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return r.filter((e,r,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===r).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,t.forwardRef)((e,r)=>{let{color:s="currentColor",size:c=24,strokeWidth:i=2,absoluteStrokeWidth:n,className:d="",children:o,iconNode:m,...x}=e;return(0,t.createElement)("svg",{ref:r,...l,width:c,height:c,stroke:s,strokeWidth:n?24*Number(i)/Number(c):i,className:a("lucide",d),...x},[...m.map(e=>{let[r,s]=e;return(0,t.createElement)(r,s)}),...Array.isArray(o)?o:[o]])}),i=(e,r)=>{let s=(0,t.forwardRef)((s,l)=>{let{className:i,...n}=s;return(0,t.createElement)(c,{ref:l,iconNode:r,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...n})});return s.displayName="".concat(e),s}},1873:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},3664:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},4361:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>b});var t=s(5155),a=s(2115),l=s(63),c=s(8525),i=s(7828),n=s(6983),d=s(1873),o=s(5016),m=s(9141),x=s(3664),p=s(1847);let h=(0,p.A)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);var u=s(5604);function f(e){var r,s;let{orderId:i,customer:n,hasAccess:d,offerAccepted:o=!1}=e,p=(0,u.useLocale)(),f=(0,l.useRouter)();(0,c.U)();let[g,y]=(0,a.useState)(!1);return d?(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Контакты заказчика"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-lg font-semibold text-gray-700",children:(null==(r=n.full_name)?void 0:r[0])||"З"})}),(0,t.jsx)("div",{children:(0,t.jsx)("p",{className:"font-medium text-gray-900",children:n.full_name})})]}),n.phone&&"***"!==n.phone&&(0,t.jsxs)("a",{href:"tel:".concat(n.phone),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,t.jsx)(m.A,{className:"w-5 h-5 text-primary"}),(0,t.jsx)("span",{className:"text-gray-900",children:n.phone})]}),n.email&&"***"!==n.email&&(0,t.jsxs)("a",{href:"mailto:".concat(n.email),className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,t.jsx)(x.A,{className:"w-5 h-5 text-primary"}),(0,t.jsx)("span",{className:"text-gray-900",children:n.email})]}),(0,t.jsxs)("a",{href:"https://wa.me/".concat(null==(s=n.phone)?void 0:s.replace(/\D/g,"")),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[(0,t.jsx)(h,{className:"w-5 h-5 text-green-600"}),(0,t.jsx)("span",{className:"text-gray-900",children:"WhatsApp"})]})]})]}):o?(0,t.jsxs)("div",{className:"card bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.A,{className:"w-6 h-6 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Контакты заказчика"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Для просмотра контактов необходимо оплатить доступ"})]})]}),(0,t.jsx)("button",{onClick:()=>{f.push("/".concat(p,"/performer/orders/").concat(i,"/purchase"))},className:"btn-primary w-full",children:"Получить контакты (5€)"})]}):(0,t.jsx)("div",{className:"card bg-gray-50",children:(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.A,{className:"w-6 h-6 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Контакты заказчика"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Дождитесь подтверждения вашего отклика заказчиком"})]})]})})}let g=(0,p.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),y=(0,p.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function j(e){let{orderId:r,orderTitle:s,isOpen:l,onClose:c,onSuccess:i}=e,[n,d]=(0,a.useState)(""),[o,m]=(0,a.useState)(""),[x,p]=(0,a.useState)(!1),[h,u]=(0,a.useState)(null);if(!l)return null;let f=async e=>{e.preventDefault(),p(!0),u(null);try{let e=await fetch("/api/offers/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:r,price:n?parseFloat(n):null,message:o.trim()})}),s=await e.json();if(!e.ok)throw Error(s.error||"Ошибка при создании отклика");d(""),m(""),i(),c()}catch(e){u(e.message)}finally{p(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6 relative",children:[(0,t.jsx)("button",{onClick:c,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:(0,t.jsx)(g,{className:"w-5 h-5"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Откликнуться на заказ"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:s}),h&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4",children:h}),(0,t.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ваша цена (€)"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:n,onChange:e=>d(e.target.value),className:"input",placeholder:"Например: 50.00"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Оставьте пустым, если цена договорная"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Сообщение заказчику *"}),(0,t.jsx)("textarea",{rows:4,required:!0,value:o,onChange:e=>m(e.target.value),className:"textarea",placeholder:"Расскажите заказчику о вашем опыте и условиях работы..."})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:c,className:"flex-1 btn-outline",disabled:x,children:"Отмена"}),(0,t.jsxs)("button",{type:"submit",disabled:x,className:"flex-1 btn-primary flex items-center justify-center gap-2",children:[(0,t.jsx)(y,{className:"w-4 h-4"}),x?"Отправка...":"Откликнуться"]})]})]})]})})}function b(){let e=(0,l.useParams)().id,r=(0,c.U)(),[s,m]=(0,a.useState)(null),[x,p]=(0,a.useState)([]),[h,u]=(0,a.useState)(!0),[g,y]=(0,a.useState)(!1),[b,N]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),[k,_]=(0,a.useState)(!1),[A,I]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&(O(),J())},[e]);let O=async()=>{let{data:{user:s}}=await r.auth.getUser();N((null==s?void 0:s.id)||null);let{data:t,error:a}=await r.from("orders").select("*, customer:profiles!orders_customer_id_fkey(full_name, email, phone)").eq("id",e).single();if(a)console.error("Error loading order:",a);else{if(s){let{data:a}=await r.from("profiles").select("role").eq("id",s.id).single();if(w((null==a?void 0:a.role)||null),t.customer_id===s.id)y(!0);else if((null==a?void 0:a.role)==="performer"){let{data:t}=await r.from("contact_purchases").select("id").eq("order_id",e).eq("performer_id",s.id).eq("status","completed").single();y(!!t);let{data:a}=await r.from("offers").select("id, status").eq("order_id",e).eq("performer_id",s.id).single();_(!!a),I((null==a?void 0:a.status)==="accepted")}}m(t)}u(!1)},J=async()=>{try{let r=(0,c.U)(),{data:s,error:t}=await r.from("offers").select("*, performer:profiles!offers_performer_id_fkey(full_name, performer_profile:performer_profiles(rating, total_reviews))").eq("order_id",e).order("created_at",{ascending:!1});t?console.error("Error loading offers:",t):p(s||[])}catch(e){console.warn("Supabase not configured:",e)}},M=async r=>{try{let s=await fetch("/api/offers/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({offerId:r,orderId:e})}),t=await s.json();if(!s.ok)return void alert(t.error||"Ошибка при принятии предложения");J(),O(),alert("Предложение принято!")}catch(e){console.error("Error accepting offer:",e),alert("Ошибка при принятии предложения")}};return h?(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,t.jsx)("p",{children:"Загрузка..."})}):s?(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[(0,t.jsxs)("div",{className:"card mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:s.title}),(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-line mb-6",children:s.description}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(i.A,{className:"w-4 h-4"}),s.budget?"".concat(s.budget,"€"):"Не указан"]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(n.A,{className:"w-4 h-4"}),(0,o.a)(s.created_at)]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(d.A,{className:"w-4 h-4"}),s.location]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:x.length>0&&(0,t.jsxs)("div",{className:"card mb-6",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:["Предложения (",x.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-4 ".concat("accepted"===e.status?"border-green-500 bg-green-50":"rejected"===e.status?"border-gray-200 bg-gray-50 opacity-60":"border-gray-200"),children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:e.performer.full_name}),"accepted"===e.status&&(0,t.jsx)("span",{className:"px-2 py-1 bg-green-500 text-white text-xs rounded",children:"Принято"}),"rejected"===e.status&&(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-400 text-white text-xs rounded",children:"Отклонено"})]}),e.performer.performer_profile&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["⭐ ",e.performer.performer_profile.rating," (",e.performer.performer_profile.total_reviews," ","отзывов)"]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"text-xl font-bold text-primary",children:e.price?"".concat(e.price,"€"):"Цена договорная"})})]}),(0,t.jsx)("p",{className:"text-gray-700 mb-4",children:e.message}),"customer"===v&&(null==s?void 0:s.status)==="open"&&"pending"===e.status&&(0,t.jsx)("button",{onClick:()=>M(e.id),className:"btn-primary",children:"Принять предложение"}),"accepted"===e.status&&(0,t.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"✓ Это предложение принято"}),"rejected"===e.status&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Это предложение отклонено"})]},e.id))})]})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:s&&b&&(0,t.jsxs)(t.Fragment,{children:["performer"===v&&!k&&("open"===s.status||"in_progress"===s.status)&&(0,t.jsxs)("div",{className:"card mb-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Хотите откликнуться?"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Предложите свою цену и условия выполнения заказа"}),(0,t.jsx)("button",{onClick:()=>S(!0),className:"btn-primary w-full",children:"Откликнуться на заказ"})]}),"performer"===v&&k&&(0,t.jsx)("div",{className:"card mb-6 bg-green-50 border border-green-200",children:(0,t.jsx)("p",{className:"text-sm text-green-800",children:"✓ Вы уже откликнулись на этот заказ"})}),(0,t.jsx)(f,{orderId:e,customer:s.customer||{full_name:"Заказчик"},hasAccess:g,offerAccepted:A})]})})]}),s&&(0,t.jsx)(j,{orderId:e,orderTitle:s.title,isOpen:C,onClose:()=>S(!1),onSuccess:()=>{J(),O(),_(!0)}})]}):(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,t.jsx)("p",{children:"Заказ не найден"})})}},5016:(e,r,s)=>{"use strict";function t(e){let r="string"==typeof e?new Date(e):e,s=Math.floor((new Date().getTime()-r.getTime())/1e3);if(s<60)return"".concat(s," секунд назад");let t=Math.floor(s/60);if(t<60)return"".concat(t," минут назад");let a=Math.floor(t/60);if(a<24)return"".concat(a," ч. назад");let l=Math.floor(a/24);return"".concat(l," дн. назад")}s.d(r,{a:()=>t})},6983:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},7828:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8525:(e,r,s)=>{"use strict";s.d(r,{U:()=>a});var t=s(5890);function a(){let e="https://rdlrzuyqbtxcszzcdtge.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkbHJ6dXlxYnR4Y3N6emNkdGdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODE5OTMsImV4cCI6MjA4MjE1Nzk5M30.xqYNOx2JD1vQrrEob6HYJlOm5w82oMi3Hv604QLgWGY";if(!e||!r)return console.error("Supabase environment variables not configured. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY"),(0,t.createBrowserClient)(e||"https://placeholder.supabase.co",r||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");try{return(0,t.createBrowserClient)(e,r)}catch(e){return console.error("Error creating Supabase client:",e),(0,t.createBrowserClient)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}},9141:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(1847).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},9230:(e,r,s)=>{Promise.resolve().then(s.bind(s,4361))}},e=>{e.O(0,[223,890,441,255,358],()=>e(e.s=9230)),_N_E=e.O()}]);