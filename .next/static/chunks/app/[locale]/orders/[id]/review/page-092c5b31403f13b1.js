(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[52],{1847:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(2115);let a=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,r)=>{let{color:t="currentColor",size:l=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:r,...i,width:l,height:l,stroke:t,strokeWidth:o?24*Number(n)/Number(l):n,className:a("lucide",c),...m},[...u.map(e=>{let[r,t]=e;return(0,s.createElement)(r,t)}),...Array.isArray(d)?d:[d]])}),n=(e,r)=>{let t=(0,s.forwardRef)((t,i)=>{let{className:n,...o}=t;return(0,s.createElement)(l,{ref:i,iconNode:r,className:a("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),n),...o})});return t.displayName="".concat(e),t}},2971:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var s=t(5155),a=t(2115),i=t(63),l=t(8525),n=t(5604),o=t(9347);async function c(e,r){let t=(0,l.U)(),{data:s}=await t.from("orders").select("status, customer_id").eq("id",e).single();if(!s||"completed"!==s.status||s.customer_id!==r)return!1;let{data:a}=await t.from("reviews").select("id").eq("order_id",e).eq("reviewer_id",r).single();return!a}function d(){let e=(0,i.useParams)(),r=(0,i.useRouter)(),t=(0,n.useLocale)(),d=e.id,u=(0,l.U)(),[m,f]=(0,a.useState)(5),[p,h]=(0,a.useState)(""),[x,w]=(0,a.useState)(!1),[b,N]=(0,a.useState)(!1),[I,g]=(0,a.useState)(null),[v,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{j()},[d]);let j=async()=>{let{data:{user:e}}=await u.auth.getUser();if(!e)return void r.push("/".concat(t,"/login"));if(!await c(d,e.id))return void r.push("/".concat(t,"/orders/").concat(d));N(!0);let{data:s,error:a}=await u.from("orders").select("*, offers!inner(performer_id, status, performer:profiles!offers_performer_id_fkey(id, full_name))").eq("id",d).eq("customer_id",e.id).eq("offers.status","accepted").single();if(a||!s){console.error("Error loading order:",a),r.push("/".concat(t,"/orders"));return}g(s),s.offers&&s.offers.length>0&&y(s.offers[0].performer)},_=async e=>{e.preventDefault(),w(!0);let{data:{user:s}}=await u.auth.getUser();if(!s||!v)return;let{error:a}=await u.from("reviews").insert({order_id:d,reviewer_id:s.id,reviewee_id:v.id,rating:m,comment:p.trim()||null});if(a){console.error("Error creating review:",a),alert("Ошибка при создании отзыва"),w(!1);return}await u.from("orders").update({status:"completed"}).eq("id",d),r.push("/".concat(t,"/orders/").concat(d)),w(!1)};return I&&v?(0,s.jsx)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Оставить отзыв"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("p",{className:"text-gray-700 mb-2",children:["Заказ: ",(0,s.jsx)("span",{className:"font-semibold",children:I.title})]}),(0,s.jsxs)("p",{className:"text-gray-700",children:["Исполнитель: ",(0,s.jsx)("span",{className:"font-semibold",children:v.full_name})]})]}),(0,s.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Оценка *"}),(0,s.jsx)("div",{className:"flex gap-2",children:[1,2,3,4,5].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>f(e),className:"focus:outline-none",children:(0,s.jsx)(o.A,{className:"w-10 h-10 ".concat(e<=m?"text-yellow-400 fill-yellow-400":"text-gray-300"," transition-colors")})},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Комментарий"}),(0,s.jsx)("textarea",{rows:6,value:p,onChange:e=>h(e.target.value),className:"textarea",placeholder:"Расскажите о вашем опыте работы с исполнителем"})]}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"btn-primary w-full",children:x?"Отправка...":"Отправить отзыв"})]})]})}):(0,s.jsx)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,s.jsx)("p",{children:"Загрузка..."})})}},5408:(e,r,t)=>{Promise.resolve().then(t.bind(t,2971))},8525:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(5890);function a(){let e="https://rdlrzuyqbtxcszzcdtge.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkbHJ6dXlxYnR4Y3N6emNkdGdlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODE5OTMsImV4cCI6MjA4MjE1Nzk5M30.xqYNOx2JD1vQrrEob6HYJlOm5w82oMi3Hv604QLgWGY";if(!e||!r)return console.error("Supabase environment variables not configured. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY"),(0,s.createBrowserClient)(e||"https://placeholder.supabase.co",r||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0");try{return(0,s.createBrowserClient)(e,r)}catch(e){return console.error("Error creating Supabase client:",e),(0,s.createBrowserClient)("https://placeholder.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}}},9347:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(1847).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])}},e=>{e.O(0,[223,890,441,255,358],()=>e(e.s=5408)),_N_E=e.O()}]);